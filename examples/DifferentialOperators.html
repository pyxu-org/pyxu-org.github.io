
<!DOCTYPE html>

<html data-theme="light" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Differential operators in Pyxu â€” Pyxu Documentation</title>
<script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
<!-- Loaded before other Sphinx assets -->
<link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet"/>
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet"/>
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet"/>
<link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet"/>
<link as="font" crossorigin="" href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" rel="preload" type="font/woff2"/>
<link href="../_static/pygments.css?v=fa44fd50" rel="stylesheet" type="text/css"/>
<link href="../_static/plot_directive.css?v=7f9a90b1" rel="stylesheet" type="text/css"/>
<link href="../_static/sphinx-codeautolink.css?v=125d5c1c" rel="stylesheet" type="text/css"/>
<link href="../_static/copybutton.css?v=76b2166b" rel="stylesheet" type="text/css"/>
<link href="../_static/togglebutton.css?v=13237357" rel="stylesheet" type="text/css"/>
<link href="../_static/sg_gallery.css?v=61a4c737" rel="stylesheet" type="text/css"/>
<link href="../_static/sg_gallery-binder.css?v=f4aeca0c" rel="stylesheet" type="text/css"/>
<link href="../_static/sg_gallery-dataframe.css?v=2082cf3c" rel="stylesheet" type="text/css"/>
<link href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" rel="stylesheet" type="text/css"/>
<link href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" rel="stylesheet" type="text/css"/>
<link href="../_static/nbsphinx-code-cells.css?v=2aa19091" rel="stylesheet" type="text/css"/>
<link href="../_static/css/custom.css?v=1031a718" rel="stylesheet" type="text/css"/>
<!-- Pre-loaded scripts that we'll load fully later -->
<link as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" rel="preload"/>
<link as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" rel="preload"/>
<script src="../_static/documentation_options.js?v=e02fc88f"></script>
<script src="../_static/doctools.js?v=888ff710"></script>
<script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
<script src="../_static/clipboard.min.js?v=a7894cd8"></script>
<script src="../_static/copybutton.js?v=30646c52"></script>
<script>let toggleHintShow = 'Click to show';</script>
<script>let toggleHintHide = 'Click to hide';</script>
<script>let toggleOpenOnPrint = 'true';</script>
<script src="../_static/togglebutton.js?v=4a39c7ea"></script>
<script src="../_static/design-tabs.js?v=36754332"></script>
<script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
<script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
<script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
<script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
<script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>DOCUMENTATION_OPTIONS.pagename = 'examples/DifferentialOperators';</script>
<link href="../_static/favicon.png" rel="icon"/>
<link href="../genindex.html" rel="index" title="Index"/>
<link href="../search.html" rel="search" title="Search"/>
<link href="../api/index.html" rel="next" title="API Reference"/>
<link href="Stencils.html" rel="prev" title="Convolution with Pyxu"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="en" name="docsearch:language"/>
</head>
<body data-bs-root-margin="0px 0px -60%" data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-default-mode="light" data-offset="180">
<a class="skip-link" href="#main-content">Skip to main content</a>
<input class="sidebar-toggle" id="__primary" name="__primary" type="checkbox"/>
<label class="overlay overlay-primary" for="__primary"></label>
<input class="sidebar-toggle" id="__secondary" name="__secondary" type="checkbox"/>
<label class="overlay overlay-secondary" for="__secondary"></label>
<div class="search-button__wrapper">
<div class="search-button__overlay"></div>
<div class="search-button__search-container">
<form action="../search.html" class="bd-search d-flex align-items-center" method="get">
<i class="fa-solid fa-magnifying-glass"></i>
<input aria-label="Search the docs ..." autocapitalize="off" autocomplete="off" autocorrect="off" class="form-control" id="search-input" name="q" placeholder="Search the docs ..." spellcheck="false" type="search"/>
<span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
</div>
<nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
<label class="sidebar-toggle primary-toggle" for="__primary">
<span class="fa-solid fa-bars"></span>
</label>
<div class="navbar-header-items__start">
<div class="navbar-item">
<a class="navbar-brand logo" href="../index.html">
<img alt="Logo image" class="logo__image only-light" src="../_static/logo.png"/>
<script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
</a></div>
</div>
<div class="col-lg-9 navbar-header-items">
<div class="me-auto navbar-header-items__center">
<div class="navbar-item"><nav class="navbar-nav">
<p aria-label="Site Navigation" aria-level="1" class="sidebar-header-items__title" role="heading">
    Site Navigation
  </p>
<ul class="bd-navbar-elements navbar-nav">
<li class="nav-item">
<a class="nav-link nav-internal" href="../intro/index.html">
                        Getting Started
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../guide/index.html">
                        User Guide
                      </a>
</li>
<li class="nav-item current active">
<a class="nav-link nav-internal" href="index.html">
                        Example Gallery
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../api/index.html">
                        API Reference
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../fair/index.html">
                        Extending Pyxu
                      </a>
</li>
</ul>
</nav></div>
</div>
<div class="navbar-header-items__end">
<div class="navbar-item navbar-persistent--container">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
</div>
<div class="navbar-item"><strong> v1.0.x </strong></div>
<div class="navbar-item"><ul aria-label="Icon Links" class="navbar-icon-links navbar-nav">
<li class="nav-item">
<a class="nav-link" data-bs-placement="bottom" data-bs-toggle="tooltip" href="https://github.com/matthieumeo/pyxu" rel="noopener" target="_blank" title="GitHub"><span><i class="fa-brands fa-github"></i></span>
<label class="sr-only">GitHub</label></a>
</li>
<li class="nav-item">
<a class="nav-link" data-bs-placement="bottom" data-bs-toggle="tooltip" href="https://pypi.org/project/pyxu/" rel="noopener" target="_blank" title="PyPI"><span><i class="fa-brands fa-python"></i></span>
<label class="sr-only">PyPI</label></a>
</li>
<li class="nav-item">
<a class="nav-link" data-bs-placement="bottom" data-bs-toggle="tooltip" href="mailto: matthieu.simeoni@gmail.com" rel="noopener" target="_blank" title="Contact"><span><i class="fa-brands fa-telegram"></i></span>
<label class="sr-only">Contact</label></a>
</li>
<li class="nav-item">
<a class="nav-link" data-bs-placement="bottom" data-bs-toggle="tooltip" href="https://imaging.epfl.ch/" rel="noopener" target="_blank" title="EPFL Center for Imaging"><img alt="EPFL Center for Imaging" class="icon-link-image" src="../_static/imaging.png"/></a>
</li>
</ul></div>
</div>
</div>
<div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
</div>
<label class="sidebar-toggle secondary-toggle" for="__secondary">
<span class="fa-solid fa-outdent"></span>
</label>
</div>
</nav>
<div class="bd-container">
<div class="bd-container__inner bd-page-width">
<div class="bd-sidebar-primary bd-sidebar">
<div class="sidebar-header-items sidebar-primary__section">
<div class="sidebar-header-items__center">
<div class="navbar-item"><nav class="navbar-nav">
<p aria-label="Site Navigation" aria-level="1" class="sidebar-header-items__title" role="heading">
    Site Navigation
  </p>
<ul class="bd-navbar-elements navbar-nav">
<li class="nav-item">
<a class="nav-link nav-internal" href="../intro/index.html">
                        Getting Started
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../guide/index.html">
                        User Guide
                      </a>
</li>
<li class="nav-item current active">
<a class="nav-link nav-internal" href="index.html">
                        Example Gallery
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../api/index.html">
                        API Reference
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../fair/index.html">
                        Extending Pyxu
                      </a>
</li>
</ul>
</nav></div>
</div>
<div class="sidebar-header-items__end">
<div class="navbar-item"><strong> v1.0.x </strong></div>
<div class="navbar-item"><ul aria-label="Icon Links" class="navbar-icon-links navbar-nav">
<li class="nav-item">
<a class="nav-link" data-bs-placement="bottom" data-bs-toggle="tooltip" href="https://github.com/matthieumeo/pyxu" rel="noopener" target="_blank" title="GitHub"><span><i class="fa-brands fa-github"></i></span>
<label class="sr-only">GitHub</label></a>
</li>
<li class="nav-item">
<a class="nav-link" data-bs-placement="bottom" data-bs-toggle="tooltip" href="https://pypi.org/project/pyxu/" rel="noopener" target="_blank" title="PyPI"><span><i class="fa-brands fa-python"></i></span>
<label class="sr-only">PyPI</label></a>
</li>
<li class="nav-item">
<a class="nav-link" data-bs-placement="bottom" data-bs-toggle="tooltip" href="mailto: matthieu.simeoni@gmail.com" rel="noopener" target="_blank" title="Contact"><span><i class="fa-brands fa-telegram"></i></span>
<label class="sr-only">Contact</label></a>
</li>
<li class="nav-item">
<a class="nav-link" data-bs-placement="bottom" data-bs-toggle="tooltip" href="https://imaging.epfl.ch/" rel="noopener" target="_blank" title="EPFL Center for Imaging"><img alt="EPFL Center for Imaging" class="icon-link-image" src="../_static/imaging.png"/></a>
</li>
</ul></div>
</div>
</div>
<div class="sidebar-primary-items__start sidebar-primary__section">
<div class="sidebar-primary-item"><nav aria-label="Section Navigation" class="bd-docs-nav bd-links">
<p aria-level="1" class="bd-links__title" role="heading">Section Navigation</p>
<div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Stencils.html">Convolution with Pyxu</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Differential operators in Pyxu</a></li>
</ul>
</div>
</nav></div>
</div>
<div class="sidebar-primary-items__end sidebar-primary__section">
</div>
<div id="rtd-footer-container"></div>
</div>
<main class="bd-main" id="main-content">
<div class="bd-content">
<div class="bd-article-container">
<div class="bd-header-article">
<div class="header-article-items header-article__inner">
<div class="header-article-items__start">
<div class="header-article-item">
<nav aria-label="Breadcrumbs">
<ul aria-label="Breadcrumb" class="bd-breadcrumbs" role="navigation">
<li class="breadcrumb-item breadcrumb-home">
<a aria-label="Home" class="nav-link" href="../index.html">
<i class="fa-solid fa-home"></i>
</a>
</li>
<li class="breadcrumb-item"><a class="nav-link" href="index.html">Example Gallery</a></li>
<li aria-current="page" class="breadcrumb-item active">Differential operators in Pyxu</li>
</ul>
</nav>
</div>
</div>
</div>
</div>
<div id="searchbox"></div>
<article class="bd-article" role="main">
<section id="Differential-operators-in-Pyxu">
<h1>Differential operators in Pyxu<a class="headerlink" href="#Differential-operators-in-Pyxu" title="Link to this heading">#</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">pyxu.operator.linop.diff</span></code> module defines a set of classes and functions related to derivative operators.</p>
<p>In the context of inverse problems, derivative operators come handy when the spatial structure of the object or image be reconstructed can be leveraged. For example, common uses of derivatives are when the image is expected to be smooth in one or more directions, or in contrast, when it is expected to have sharp edges and flat regions. In those cases, the derivative operators are used as part of regularization terms, adding prior knowledge to our solution (see example TODO).</p>
<section id="1.-Partial-derivatives">
<h2>1. Partial derivatives<a class="headerlink" href="#1.-Partial-derivatives" title="Link to this heading">#</a></h2>
<p>The most basic differential operator is the <strong>partial derivative</strong>:</p>
<p><span class="math">\begin{align}
\frac{\partial^{n}}{\partial x_0^{n_0} \cdots \partial x_{D-1}^{n_{D-1}}}
\end{align}</span></p>
<p>Which when applied to an given signal <span class="math notranslate nohighlight">\(\mathbf{f}\)</span>, yields:</p>
<p><span class="math">\begin{align}
\frac{\partial^{n}}{\partial x_0^{n_0} \cdots \partial x_{D-1}^{n_{D-1}}}\mathbf{f} =\mathbf{D}\mathbf{f}\in \mathbb{R}^{N_0 \times \cdots \times N_{D-1}}
\end{align}</span></p>
<p>Partial derivatives in <code class="docutils literal notranslate"><span class="pre">Pyxu</span></code> are computed via efficient <strong>matrix-free</strong> implementation, which is based on <a class="reference external" href="https://numba.pydata.org/numba-doc/latest/user/stencil.html">JIT compiled stencils</a>. For illustrative purposes, consider the following approximation to the partial derivatives:</p>
<p><span class="math">\begin{align}
\mathbf{D} f [n] = f[n+1] - f[n]
\end{align}</span></p>
<p>As we will see below, this is the forward finite difference approximation. This could be implemented in <strong>matrix-form</strong>, in which case it would look like this:</p>
<center><p><img alt="1b48e3d0997a4df19782cd153191098e" class="no-scaled-link" src="../_images/matrix-form.png" style="width: 400px;"/></p>
</center><p>Or, it could be instead implemented via a for loop, in which the case of large input signals, would not require storing a large matrix:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">D</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Computes the partial derivative via forward finite differences.</span>

<span class="sd">    Input</span>
<span class="sd">    -----</span>
<span class="sd">    f: vector</span>
<span class="sd">        Input signal</span>

<span class="sd">    Output</span>
<span class="sd">    ------</span>
<span class="sd">    y: vector</span>
<span class="sd">        Derivative</span>
<span class="sd">    """</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/stdtypes.html#range" title="range"><span class="nb">range</span></a><span class="p">(</span><a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#len" title="len"><span class="nb">len</span></a><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">f</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">y</span>
</pre></div>
</div>
<p>Despite Python being very slow when it comes to for loops, there are some ways to make them really efficient (see <a class="reference external" href="TODO">HPC example</a>).</p>
<!---
 finite_difference = PartialDerivative.finite_difference(
            arg_shape=(10,),
            order=(1, ),
            scheme="forward",
            accuracy=1,)

fig, ax = plt.subplots(figsize=(5,5))
im = ax.imshow(finite_difference.asarray(), cmap="RdYlBu")
ax.set_xticks(np.arange(cut - 1) + 0.5, [])
ax.set_yticks(np.arange(cut - 1) + 0.5, [])
ax.grid(linewidth=3, color="white")
ax.set_title("Finite difference operator (matrix-form)")
plt.colorbar(im, ax=ax)
fig.tight_layout()
fig.savefig("data/images/matrix-form.png", dpi=200)
---><section id="1.1.-Parameters">
<h3>1.1. Parameters<a class="headerlink" href="#1.1.-Parameters" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">PartialDerivative</span></code> class implements two main approximations to the partial derivatives as methods:<code class="docutils literal notranslate"><span class="pre">finite_difference</span></code> and <code class="docutils literal notranslate"><span class="pre">gaussian_derivative</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">finite_difference</span><span class="p">(</span>
        <span class="n">arg_shape</span><span class="p">:</span> <span class="n">pyct</span><span class="o">.</span><span class="n">NDArrayShape</span><span class="p">,</span>
        <span class="n">order</span><span class="p">:</span> <span class="n">cabc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="n">pyct</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
        <span class="n">scheme</span><span class="p">:</span> <span class="n">typ</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">cabc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">"forward"</span><span class="p">,</span>
        <span class="n">accuracy</span><span class="p">:</span> <span class="n">typ</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">pyct</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">cabc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="n">pyct</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">:</span> <span class="n">ModeSpec</span> <span class="o">=</span> <span class="s2">"constant"</span><span class="p">,</span>
        <span class="n">gpu</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">typ</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">pyct</span><span class="o">.</span><span class="n">DType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sampling</span><span class="p">:</span> <span class="n">typ</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">pyct</span><span class="o">.</span><span class="n">Real</span><span class="p">,</span> <span class="n">cabc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="n">pyct</span><span class="o">.</span><span class="n">Real</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyct</span><span class="o">.</span><span class="n">OpT</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gaussian_derivative</span><span class="p">(</span>
        <span class="n">arg_shape</span><span class="p">:</span> <span class="n">pyct</span><span class="o">.</span><span class="n">NDArrayShape</span><span class="p">,</span>
        <span class="n">order</span><span class="p">:</span> <span class="n">cabc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="n">pyct</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
        <span class="n">sigma</span><span class="p">:</span> <span class="n">typ</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">pyct</span><span class="o">.</span><span class="n">Real</span><span class="p">,</span> <span class="n">cabc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="n">pyct</span><span class="o">.</span><span class="n">Real</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">truncate</span><span class="p">:</span> <span class="n">typ</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">pyct</span><span class="o">.</span><span class="n">Real</span><span class="p">,</span> <span class="n">cabc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="n">pyct</span><span class="o">.</span><span class="n">Real</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">:</span> <span class="n">ModeSpec</span> <span class="o">=</span> <span class="s2">"constant"</span><span class="p">,</span>
        <span class="n">gpu</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">typ</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">pyct</span><span class="o">.</span><span class="n">DType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sampling</span><span class="p">:</span> <span class="n">typ</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">pyct</span><span class="o">.</span><span class="n">Real</span><span class="p">,</span> <span class="n">cabc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="n">pyct</span><span class="o">.</span><span class="n">Real</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyct</span><span class="o">.</span><span class="n">OpT</span>
</pre></div>
</div>
<p>The common arguments are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">arg_shape</span></code>: Shape of the input image. This is information is necessary in case batch processing is intended.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">order</span></code>: Derivative order in each axis. For example, for a 2D image input:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">order=(1,</span> <span class="pre">2)</span></code> would yield:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial^{3} \mathbf{f}}{\partial x \partial y^{2}}\]</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">order=(2,</span> <span class="pre">0)</span></code> would yield:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial^{2} \mathbf{f}}{\partial x^{2}}\]</div>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">mode</span></code>: Padding mode to define boundary conditions. Pre-padding and post-trimming are computed to yield an output array of the same shape as the input. It can be defined in general (with a <code class="docutils literal notranslate"><span class="pre">string</span></code>) or per axis (with a <code class="docutils literal notranslate"><span class="pre">tuple</span></code>). The available modes are:</p>
<ul class="simple">
<li><p>â€˜constantâ€™</p></li>
<li><p>â€˜wrapâ€™</p></li>
<li><p>â€˜reflectâ€™</p></li>
<li><p>â€˜symmetricâ€™</p></li>
<li><p>â€˜edgeâ€™</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">gpu</span></code>: Whether the differential operator is meant for GPU or CPU computation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dtype</span></code>: Desired precision of computation (single precision is faster than double)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sampling</span></code>: Spacing between pixels. It can be defined in general (with a <code class="docutils literal notranslate"><span class="pre">float/int</span></code>) or per axis (with a <code class="docutils literal notranslate"><span class="pre">tuple</span></code>)</p></li>
</ul>
<p>The sections below it is explained the differences between these two methods and their specific arguments.</p>
<div class="alert alert-block alert-warning"><p>Important: Differential operators are not backend nor dtype agnostic! The arguments <code class="docutils literal notranslate"><span class="pre">gpu</span></code> and <code class="docutils literal notranslate"><span class="pre">dtype</span></code> must be chosen adequately.</p>
</div></section>
<section id="1.2.-Finite-differences">
<h3>1.2. Finite differences<a class="headerlink" href="#1.2.-Finite-differences" title="Link to this heading">#</a></h3>
<p>Finite differences approximate the derivatives by computing the difference between pixel values in the image. There are different variations of finite differences, such as forward differences, backward differences, and central differences.</p>
<ul class="simple">
<li><p><em>Forward Differences</em>: <span class="math notranslate nohighlight">\(\mathbf{D}_{F} f [n] = \frac{f[n+1] - f[n]}{h}\)</span></p></li>
<li><p><em>Backward Differences</em>: <span class="math notranslate nohighlight">\(\mathbf{D}_{B} f [n] = \frac{f[n] - f[n-1]}{h}\)</span></p></li>
<li><p><em>Central Differences</em>: <span class="math notranslate nohighlight">\(\mathbf{D}_{C} f [n] = \frac{f[n+1] - f[n-1]}{2h}\)</span></p></li>
</ul>
<p>Another important parameter for finite difference is the accuracy, which defines the number of digits used for the approximation.</p>
<p>These are some kernels generated by different parameterizations: the (parenthesis) indicates the central element.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Accuracy</strong></p></th>
<th class="head"><p><em>Forward</em></p></th>
<th class="head"><p><em>Backward</em></p></th>
<th class="head"><p><em>Central</em></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>1</em></p></td>
<td><p>[<strong>-1</strong>, 1]</p></td>
<td><p>[-1, <strong>1</strong>]</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><em>2</em></p></td>
<td><p>[<strong>-3/2</strong>, 2, -1/2]</p></td>
<td><p>[1/2, -2, <strong>3/2</strong>]</p></td>
<td><p>[-1/2, <strong>0</strong>, 1/2]</p></td>
</tr>
<tr class="row-even"><td><p><em>4</em></p></td>
<td><p>[ <strong>-25/12</strong> , 48/12, -36/12, 16/12, -3/12]</p></td>
<td><p>[ <strong>3/12</strong> , -16/12, 36/12, -48/12, 25/12]</p></td>
<td><p>[1/12, -2/3, <strong>0</strong>, 2/3, -1/12]</p></td>
</tr>
</tbody>
</table>
<p>Where the coefficients in <strong>bold</strong> indicate the center of the kernel. You can explore different parametrizations with the <a class="reference external" href="https://web.media.mit.edu/~crtaylor/calculator.html">finite difference coefficient calculator</a>, or you can directly create different instantiations and check the coefficients with the <code class="docutils literal notranslate"><span class="pre">PartialDerivative.visualize()</span></code> method.</p>
<p>Finite differences are simple to compute and do not require any additional assumptions or pre-processing steps:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <a class="sphinx-codeautolink-a" href="https://matplotlib.org/stable/api/pyplot_summary.html#module-matplotlib.pyplot" title="matplotlib.pyplot"><span class="nn">matplotlib.pyplot</span></a> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <a class="sphinx-codeautolink-a" href="https://numpy.org/doc/stable/reference/index.html#module-numpy" title="numpy"><span class="nn">numpy</span></a> <span class="k">as</span> <span class="nn">np</span>

<span class="n">rng</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://numpy.org/doc/stable/reference/random/generator.html#numpy.random.default_rng" title="numpy.random.default_rng"><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span></a><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">pyxu.operator</span> <span class="kn">import</span> <a class="sphinx-codeautolink-a" href="../api/operator/linop.html#pyxu.operator.linop.diff.PartialDerivative" title="pyxu.operator.linop.diff.PartialDerivative"><span class="n">PartialDerivative</span></a>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1) Define ground truth signal</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">500</span>  <span class="c1"># number of points</span>
<span class="n">x_ax</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://numpy.org/doc/stable/reference/generated/numpy.linspace.html#numpy.linspace" title="numpy.linspace"><span class="n">np</span><span class="o">.</span><span class="n">linspace</span></a><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <a class="sphinx-codeautolink-a" href="https://numpy.org/doc/stable/reference/constants.html#numpy.pi" title="numpy.pi"><span class="n">np</span><span class="o">.</span><span class="n">pi</span></a><span class="p">,</span> <span class="n">N</span><span class="p">)</span>  <span class="c1"># coordinates</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">x_ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># sampling or pixel size</span>

<span class="n">arr</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://numpy.org/doc/stable/reference/generated/numpy.sin.html#numpy.sin" title="numpy.sin"><span class="n">np</span><span class="o">.</span><span class="n">sin</span></a><span class="p">(</span><span class="n">x_ax</span><span class="p">)</span>  <span class="c1"># ground truth signal</span>
<span class="n">derivative</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://numpy.org/doc/stable/reference/generated/numpy.cos.html#numpy.cos" title="numpy.cos"><span class="n">np</span><span class="o">.</span><span class="n">cos</span></a><span class="p">(</span><span class="n">x_ax</span><span class="p">)</span>  <span class="c1"># ground truth derivative</span>


<span class="c1"># 2) Define noisy measurements</span>
<span class="n">noise</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
<span class="n">arr_noisy</span> <span class="o">=</span> <span class="n">arr</span> <span class="o">+</span> <span class="n">noise</span>


<span class="c1"># 3) Instantiate partial derivative operator via finite differences</span>
<span class="n">finite_difference</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/operator/linop.html#pyxu.operator.linop.diff.PartialDerivative.finite_difference" title="pyxu.operator.linop.diff.PartialDerivative.finite_difference"><span class="n">PartialDerivative</span><span class="o">.</span><span class="n">finite_difference</span></a><span class="p">(</span>
    <span class="n">arg_shape</span><span class="o">=</span><span class="p">(</span><span class="n">N</span><span class="p">,),</span>
    <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span>
    <span class="n">scheme</span><span class="o">=</span><span class="s2">"forward"</span><span class="p">,</span>
    <span class="n">accuracy</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">sampling</span><span class="o">=</span><span class="n">dx</span><span class="p">,</span>  <span class="c1"># we should include the pixel size for accurate approximation</span>
<span class="p">)</span>

<span class="c1"># 4) Estimate derivative</span>
<span class="n">derivative_fd</span> <span class="o">=</span> <span class="n">finite_difference</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
<span class="n">derivative_fd_noisy</span> <span class="o">=</span> <span class="n">finite_difference</span><span class="p">(</span><span class="n">arr_noisy</span><span class="p">)</span>

<span class="c1"># 5) Plot results</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_ax</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Signal"</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">"k"</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_ax</span><span class="p">,</span> <span class="n">arr_noisy</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Noisy signal"</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">"C1"</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_ax</span><span class="p">,</span> <span class="n">derivative</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Derivative of non-noisy signal"</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">"k"</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x_ax</span><span class="p">,</span> <span class="n">derivative_fd</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">"--"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Finite difference (non-noisy signal)"</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">"C2"</span>
<span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x_ax</span><span class="p">,</span>
    <span class="n">derivative_fd_noisy</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">"Finite difference (noisy signal)"</span><span class="p">,</span>
    <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><span class="s2">"C3"</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="o">.</span><span class="n">ravel</span><span class="p">():</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Time [s]"</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Amplitude"</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/joan/miniconda3/envs/pyxu/lib/python3.11/site-packages/numba/np/ufunc/parallel.py:371: NumbaWarning: <span class="ansi-bold">The TBB threading layer requires TBB version 2021 update 6 or later i.e., TBB_INTERFACE_VERSION &gt;= 12060. Found TBB_INTERFACE_VERSION = 12050. The TBB threading layer is disabled.</span>
  warnings.warn(problem)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_DifferentialOperators_13_1.png" src="../_images/examples_DifferentialOperators_13_1.png"/>
</div>
</div>
<p>These results indicate that finite differences work fine for non-noisy data, but they can be quite <strong>sensitive to noise</strong> in the image and may introduce inaccuracies, especially when the image has high-frequency content. For more detailed information on this topic, check <a class="reference external" href="https://www.crisluengo.net/archives/22/">this great post on Gaussian derivative</a>.</p>
</section>
<section id="1.3.Gaussian-derivative">
<h3>1.3.Gaussian derivative<a class="headerlink" href="#1.3.Gaussian-derivative" title="Link to this heading">#</a></h3>
<p>The Gaussian derivative is an alternative method for estimating partial derivatives. It is derived by <strong>convolving a signal with a Gaussian kernel and then computing the derivatives</strong> of the resulting smoothed signal.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gaussian_derivative</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/operator/linop.html#pyxu.operator.linop.diff.PartialDerivative.gaussian_derivative" title="pyxu.operator.linop.diff.PartialDerivative.gaussian_derivative"><span class="n">PartialDerivative</span><span class="o">.</span><span class="n">gaussian_derivative</span></a><span class="p">(</span>
    <span class="n">arg_shape</span><span class="o">=</span><span class="p">(</span><span class="n">N</span><span class="p">,),</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">sigma</span><span class="o">=</span><span class="n">dx</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sampling</span><span class="o">=</span><span class="p">(</span><span class="n">dx</span><span class="p">,)</span>
<span class="p">)</span>
<span class="n">gaussian_derivative</span><span class="o">.</span><span class="n">visualize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
'[-21.766068359509617 (0.0) 21.766068359509617]'
</pre></div></div>
</div>
<p>The main idea behind Gaussian derivative is to smooth the image with a Gaussian filter, which effectively suppresses noise and reduces the impact of high-frequency variations. The derivative of the Gaussian filter is known analitically, thus the Gaussian derivative is not an approximation of the partial derivative, but the exact derivative of the smoothed signal. This fact leads a biased but more robust estimator compared to finite differences.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">derviative_gd</span> <span class="o">=</span> <span class="n">gaussian_derivative</span><span class="p">(</span><span class="n">arr_noisy</span><span class="p">)</span>
<span class="n">derviative_fd</span> <span class="o">=</span> <span class="n">finite_difference</span><span class="p">(</span><span class="n">arr_noisy</span><span class="p">)</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_ax</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Signal"</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">"k"</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_ax</span><span class="p">,</span> <span class="n">arr_noisy</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Noisy signal"</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">"C1"</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_ax</span><span class="p">,</span> <span class="n">derivative</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Derivative of non-noisy signal"</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">"k"</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x_ax</span><span class="p">,</span>
    <span class="n">derivative_fd_noisy</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">"Finite difference (noisy signal)"</span><span class="p">,</span>
    <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><span class="s2">"C3"</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x_ax</span><span class="p">,</span> <span class="n">derviative_gd</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Gaussian derivative (noisy signal)"</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">"C4"</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="o">.</span><span class="n">ravel</span><span class="p">():</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Time [s]"</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Amplitude"</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_DifferentialOperators_19_0.png" src="../_images/examples_DifferentialOperators_19_0.png"/>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gaussian_derivative_accurate</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/operator/linop.html#pyxu.operator.linop.diff.PartialDerivative.gaussian_derivative" title="pyxu.operator.linop.diff.PartialDerivative.gaussian_derivative"><span class="n">PartialDerivative</span><span class="o">.</span><span class="n">gaussian_derivative</span></a><span class="p">(</span>
    <span class="n">arg_shape</span><span class="o">=</span><span class="p">(</span><span class="n">N</span><span class="p">,),</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">sigma</span><span class="o">=</span><span class="n">dx</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sampling</span><span class="o">=</span><span class="p">(</span><span class="n">dx</span><span class="p">,)</span>
<span class="p">)</span>


<span class="n">derviative_gd_accurate</span> <span class="o">=</span> <span class="n">gaussian_derivative_accurate</span><span class="p">(</span><span class="n">arr_noisy</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_ax</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Signal"</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">"k"</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_ax</span><span class="p">,</span> <span class="n">arr_noisy</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Noisy signal"</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">"C1"</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_ax</span><span class="p">,</span> <span class="n">derivative</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Derivative of non-noisy signal"</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">"k"</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x_ax</span><span class="p">,</span> <span class="n">derviative_gd</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Gaussian derivative (1x$\sigma$)"</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">"C4"</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x_ax</span><span class="p">,</span>
    <span class="n">derviative_gd_accurate</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">"Gaussian derivative (4x$\sigma$)"</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><span class="s2">"C6"</span><span class="p">,</span>
    <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="o">.</span><span class="n">ravel</span><span class="p">():</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Time [s]"</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Amplitude"</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_DifferentialOperators_20_0.png" src="../_images/examples_DifferentialOperators_20_0.png"/>
</div>
</div>
<p>Gaussian derivatives can be computed for different orders of derivatives (e.g., first-order, second-order) and at different scales (by varying the standard deviation of the Gaussian kernel). Higher-order derivatives capture more detailed information about the imageâ€™s structure, while larger scales provide a more global representation.</p>
</section>
<section id="1.4.-How-to-choose?">
<h3>1.4. How to choose?<a class="headerlink" href="#1.4.-How-to-choose?" title="Link to this heading">#</a></h3>
<p>The choice between <em>finite difference</em> and <em>Gaussian derivative</em> can be seen as a <strong>trade-off between bias and variance</strong>: - When estimating partial derivatives, the Gaussian derivative robustly captures the true behavior of the derivative of the smoothed signal, thus introducing bias in the estimation. - On the other hand, finite differences, especially when using a small accuracy value, can be highly sensitive to noise and can produce unstable estimates of the derivative (variance). Gaussian
derivatives, on the other hand, tend to be smoother and less affected by noise.</p>
<p>As a rule of thumb, it is recommended to try both approaches and to use the Gaussian derivative for very noisy signals.</p>
</section>
</section>
<section id="2.-Stacks-of-partial-derivatives">
<h2>2. Stacks of partial derivatives<a class="headerlink" href="#2.-Stacks-of-partial-derivatives" title="Link to this heading">#</a></h2>
<p>There are two main classes of stacks of partial derivative:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Gradient</span></code>: stack of all first order derivatives (one per axis),</p></li>
</ul>
<p>:nbsphinx-math:<a href="#id1"><span class="problematic" id="id2">`</span></a>begin{align}
mathbf{f} = begin{bmatrix}</p>
<blockquote>
<div><p>frac{partial mathbf{f}}{partial x_0} \
vdots \
frac{partial mathbf{f}}{partial x_{D-1}}
end{bmatrix} in mathbb{R}^{D times N_{0} times cdots times N_{D-1}}</p>
</div></blockquote>
<p>end{align}`</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Hessian</span></code>: stack of all second order derivatives,</p></li>
</ul>
<dl class="simple">
<dt>:nbsphinx-math:<a href="#id3"><span class="problematic" id="id4">`</span></a>begin{align}</dt><dd><dl class="simple">
<dt>mathbf{H} mathbf{f} = begin{bmatrix}</dt><dd><p>dfrac{ partial^{2}mathbf{f} }{ partial x_{0}^{2} } &amp;  dfrac{ partial^{2}mathbf{f} }{ partial x_{0},partial x_{1} } &amp; cdots &amp; dfrac{ partial^{2}mathbf{f} }{ partial x_{0} , partial x_{D-1} } \
dfrac{ partial^{2}mathbf{f} }{ partial x_{1} , partial x_{0} } &amp; dfrac{ partial^{2}mathbf{f} }{ partial x_{1}^{2} } &amp; cdots &amp; dfrac{ partial^{2}mathbf{f} }{partial x_{1} ,partial x_{D-1}} \
vdots &amp; vdots &amp; ddots &amp; vdots \
dfrac{ partial^{2}mathbf{f} }{ partial x_{D-1} , partial x_{0} } &amp; dfrac{ partial^{2}mathbf{f} }{ partial x_{D-1} , partial x_{1} } &amp; cdots &amp; dfrac{ partial^{2}mathbf{f} }{ partial x_{D-1}^{2}}
end{bmatrix}</p>
</dd>
</dl>
</dd>
</dl>
<p>end{align}`</p>
<section id="2.1.-Parameters">
<h3>2.1. Parameters<a class="headerlink" href="#2.1.-Parameters" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Gradient</span></code> and <code class="docutils literal notranslate"><span class="pre">Hessian</span></code> objects are parametrized as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Gradient</span><span class="p">(</span>
    <span class="n">arg_shape</span><span class="p">:</span> <span class="n">pyct</span><span class="o">.</span><span class="n">NDArrayShape</span><span class="p">,</span>
    <span class="n">directions</span><span class="p">:</span> <span class="n">typ</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">pyct</span><span class="o">.</span><span class="n">NDArrayAxis</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">diff_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"fd"</span><span class="p">,</span>
    <span class="n">mode</span><span class="p">:</span> <span class="n">ModeSpec</span> <span class="o">=</span> <span class="s2">"constant"</span><span class="p">,</span>
    <span class="n">gpu</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">dtype</span><span class="p">:</span> <span class="n">typ</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">pyct</span><span class="o">.</span><span class="n">DType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">diff_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyct</span><span class="o">.</span><span class="n">OpT</span><span class="p">:</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Hessian</span><span class="p">(</span>
    <span class="n">arg_shape</span><span class="p">:</span> <span class="n">pyct</span><span class="o">.</span><span class="n">NDArrayShape</span><span class="p">,</span>
    <span class="n">directions</span><span class="p">:</span> <span class="n">typ</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span>
        <span class="nb">str</span><span class="p">,</span>
        <span class="n">cabc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="n">pyct</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">pyct</span><span class="o">.</span><span class="n">Integer</span><span class="p">],</span>
        <span class="n">cabc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="n">cabc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="n">pyct</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">pyct</span><span class="o">.</span><span class="n">Integer</span><span class="p">],</span> <span class="o">...</span><span class="p">],</span>
    <span class="p">]</span> <span class="o">=</span> <span class="s2">"all"</span><span class="p">,</span>
    <span class="n">diff_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"fd"</span><span class="p">,</span>
    <span class="n">mode</span><span class="p">:</span> <span class="n">ModeSpec</span> <span class="o">=</span> <span class="s2">"constant"</span><span class="p">,</span>
    <span class="n">gpu</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">dtype</span><span class="p">:</span> <span class="n">typ</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">pyct</span><span class="o">.</span><span class="n">DType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">diff_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyct</span><span class="o">.</span><span class="n">OpT</span><span class="p">:</span>
</pre></div>
</div>
<p>There are some common arguments that we didnâ€™t see in the previous <code class="docutils literal notranslate"><span class="pre">PartialDerivative</span></code> class:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">diff_method</span></code>: This will select between <code class="docutils literal notranslate"><span class="pre">finite_difference</span></code> (â€˜fdâ€™) or <code class="docutils literal notranslate"><span class="pre">gaussian_derivative</span></code> (â€˜gdâ€™) type of partial derivatives.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">parallel</span></code>: If <code class="docutils literal notranslate"><span class="pre">True</span></code>, it will compute the different partial derivatives in parrellalel on different threads.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">diff_kwargs</span></code>: Placeholder to specify arguments that are specific to <code class="docutils literal notranslate"><span class="pre">finite_difference</span></code> and <code class="docutils literal notranslate"><span class="pre">gaussian_derivative</span></code>.</p></li>
</ul>
<p>The sections below it is explained the differences between these two methods and their specific arguments.</p>
<div class="alert alert-block alert-warning"><p>Important: Be aware that the <code class="docutils literal notranslate"><span class="pre">directions</span></code> argument has different behavior between <code class="docutils literal notranslate"><span class="pre">Gradient</span></code> and <code class="docutils literal notranslate"><span class="pre">Hessian</span></code>. Keep reading for further details.</p>
</div></section>
<section id="2.2.-Gradient">
<h3>2.2. Gradient<a class="headerlink" href="#2.2.-Gradient" title="Link to this heading">#</a></h3>
<p>The gradient operator applies the first-order derivatives on all dimensions if the signal and concatenates them.</p>
<p>For example, in the case of a 2-dimensional image, the gradient operator implements:</p>
<p>:nbsphinx-math:<a href="#id6"><span class="problematic" id="id7">`</span></a>begin{align}
boldsymbol{nabla} mathbf{f} = begin{bmatrix}</p>
<blockquote>
<div><p>frac{partial mathbf{f}}{partial x} \
frac{partial mathbf{f}}{partial y}
end{bmatrix} in mathbb{R}^{2 times N_{x} times N_{y}}</p>
</div></blockquote>
<p>end{align}`</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">pyxu.operator</span> <span class="kn">import</span> <a class="sphinx-codeautolink-a" href="../api/operator/linop.html#pyxu.operator.linop.diff.Gradient" title="pyxu.operator.linop.diff.Gradient"><span class="n">Gradient</span></a>

<span class="n">toucan</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://numpy.org/doc/stable/reference/generated/numpy.array.html#numpy.array" title="numpy.array"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">"../_static/favicon.png"</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">"L"</span><span class="p">))</span>
<span class="n">toucan</span> <span class="o">=</span> <span class="n">toucan</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#float" title="float"><span class="nb">float</span></a><span class="p">)</span>
<span class="n">toucan</span> <span class="o">/=</span> <span class="n">toucan</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="n">grad</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/operator/linop.html#pyxu.operator.linop.diff.Gradient" title="pyxu.operator.linop.diff.Gradient"><span class="n">Gradient</span></a><span class="p">(</span>
    <span class="n">arg_shape</span><span class="o">=</span><span class="n">toucan</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
    <span class="n">diff_type</span><span class="o">=</span><span class="s2">"gd"</span><span class="p">,</span>
    <span class="n">sigma</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">out</span> <span class="o">=</span> <span class="n">grad</span><span class="o">.</span><span class="n">unravel</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">toucan</span><span class="o">.</span><span class="n">ravel</span><span class="p">()))</span>

<span class="c1"># Plot</span>
<span class="n">fig</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.figure.html#matplotlib.pyplot.figure" title="matplotlib.pyplot.figure"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span></a><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_gridspec</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">axs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="mi">1</span><span class="p">]),</span>
<span class="p">]</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">toucan</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">"gray_r"</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$\mathbf</span><span class="si">{f}</span><span class="s2">$"</span><span class="p">)</span>
<a class="sphinx-codeautolink-a" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.colorbar.html#matplotlib.pyplot.colorbar" title="matplotlib.pyplot.colorbar"><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span></a><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">"seismic"</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><a class="sphinx-codeautolink-a" href="https://numpy.org/doc/stable/reference/generated/numpy.max.html#numpy.max" title="numpy.max"><span class="n">np</span><span class="o">.</span><span class="n">max</span></a><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="n">vmax</span><span class="o">=</span><a class="sphinx-codeautolink-a" href="https://numpy.org/doc/stable/reference/generated/numpy.max.html#numpy.max" title="numpy.max"><span class="n">np</span><span class="o">.</span><span class="n">max</span></a><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$\nabla_</span><span class="si">{x}</span><span class="s2">\mathbf</span><span class="si">{f}</span><span class="s2">$"</span><span class="p">)</span>
<a class="sphinx-codeautolink-a" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.colorbar.html#matplotlib.pyplot.colorbar" title="matplotlib.pyplot.colorbar"><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span></a><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">"seismic"</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><a class="sphinx-codeautolink-a" href="https://numpy.org/doc/stable/reference/generated/numpy.max.html#numpy.max" title="numpy.max"><span class="n">np</span><span class="o">.</span><span class="n">max</span></a><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">vmax</span><span class="o">=</span><a class="sphinx-codeautolink-a" href="https://numpy.org/doc/stable/reference/generated/numpy.max.html#numpy.max" title="numpy.max"><span class="n">np</span><span class="o">.</span><span class="n">max</span></a><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$\nabla_</span><span class="si">{y}</span><span class="s2">\mathbf</span><span class="si">{f}</span><span class="s2">$"</span><span class="p">)</span>
<a class="sphinx-codeautolink-a" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.colorbar.html#matplotlib.pyplot.colorbar" title="matplotlib.pyplot.colorbar"><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span></a><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$x$"</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$y$"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_DifferentialOperators_31_0.png" src="../_images/examples_DifferentialOperators_31_0.png"/>
</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>                                                        â”Œâ”€â”€â”€&gt;  Jacobian
                          â”Œâ”€â”€â”€&gt;   Gradient (order=1)  â”€â”€â”´â”€â”€â”€&gt;  Divergence
PartialDerivative   â”€â”€â”€â”€â”€â”€â”¤
                          â””â”€â”€â”€&gt;   Hessian  (order=2)  â”€â”€â”€â”€â”€â”€&gt;  Laplacian
</pre></div>
</div>
</section>
<section id="2.3.-Hessian">
<h3>2.3. Hessian<a class="headerlink" href="#2.3.-Hessian" title="Link to this heading">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyxu.operator</span> <span class="kn">import</span> <a class="sphinx-codeautolink-a" href="../api/operator/linop.html#pyxu.operator.linop.diff.Hessian" title="pyxu.operator.linop.diff.Hessian"><span class="n">Hessian</span></a>

<span class="n">hes</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/operator/linop.html#pyxu.operator.linop.diff.Hessian" title="pyxu.operator.linop.diff.Hessian"><span class="n">Hessian</span></a><span class="p">(</span>
    <span class="n">arg_shape</span><span class="o">=</span><span class="n">toucan</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
    <span class="n">diff_type</span><span class="o">=</span><span class="s2">"gd"</span><span class="p">,</span>
    <span class="n">sigma</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">out</span> <span class="o">=</span> <span class="n">hes</span><span class="o">.</span><span class="n">unravel</span><span class="p">(</span><span class="n">hes</span><span class="p">(</span><span class="n">toucan</span><span class="o">.</span><span class="n">ravel</span><span class="p">()))</span>

<span class="c1"># Plot</span>
<span class="n">fig</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.figure.html#matplotlib.pyplot.figure" title="matplotlib.pyplot.figure"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span></a><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_gridspec</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">axs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="mi">1</span><span class="p">]),</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="mi">2</span><span class="p">]),</span>
<span class="p">]</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">toucan</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">"gray_r"</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$\mathbf</span><span class="si">{f}</span><span class="s2">$"</span><span class="p">)</span>
<a class="sphinx-codeautolink-a" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.colorbar.html#matplotlib.pyplot.colorbar" title="matplotlib.pyplot.colorbar"><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span></a><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">"seismic"</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><a class="sphinx-codeautolink-a" href="https://numpy.org/doc/stable/reference/generated/numpy.max.html#numpy.max" title="numpy.max"><span class="n">np</span><span class="o">.</span><span class="n">max</span></a><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="p">])),</span> <span class="n">vmax</span><span class="o">=</span><a class="sphinx-codeautolink-a" href="https://numpy.org/doc/stable/reference/generated/numpy.max.html#numpy.max" title="numpy.max"><span class="n">np</span><span class="o">.</span><span class="n">max</span></a><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
<span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$\mathbf</span><span class="si">{H}</span><span class="s2">_</span><span class="si">{xx}</span><span class="s2">\mathbf</span><span class="si">{f}</span><span class="s2">$"</span><span class="p">)</span>
<a class="sphinx-codeautolink-a" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.colorbar.html#matplotlib.pyplot.colorbar" title="matplotlib.pyplot.colorbar"><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span></a><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">"seismic"</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><a class="sphinx-codeautolink-a" href="https://numpy.org/doc/stable/reference/generated/numpy.max.html#numpy.max" title="numpy.max"><span class="n">np</span><span class="o">.</span><span class="n">max</span></a><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="n">vmax</span><span class="o">=</span><a class="sphinx-codeautolink-a" href="https://numpy.org/doc/stable/reference/generated/numpy.max.html#numpy.max" title="numpy.max"><span class="n">np</span><span class="o">.</span><span class="n">max</span></a><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$\mathbf</span><span class="si">{H}</span><span class="s2">_</span><span class="si">{yx}</span><span class="s2">\mathbf</span><span class="si">{f}</span><span class="s2">$"</span><span class="p">)</span>
<a class="sphinx-codeautolink-a" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.colorbar.html#matplotlib.pyplot.colorbar" title="matplotlib.pyplot.colorbar"><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span></a><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">"seismic"</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><a class="sphinx-codeautolink-a" href="https://numpy.org/doc/stable/reference/generated/numpy.max.html#numpy.max" title="numpy.max"><span class="n">np</span><span class="o">.</span><span class="n">max</span></a><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">vmax</span><span class="o">=</span><a class="sphinx-codeautolink-a" href="https://numpy.org/doc/stable/reference/generated/numpy.max.html#numpy.max" title="numpy.max"><span class="n">np</span><span class="o">.</span><span class="n">max</span></a><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$\mathbf</span><span class="si">{H}</span><span class="s2">_</span><span class="si">{xy}</span><span class="s2">\mathbf</span><span class="si">{f}</span><span class="s2">$"</span><span class="p">)</span>
<a class="sphinx-codeautolink-a" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.colorbar.html#matplotlib.pyplot.colorbar" title="matplotlib.pyplot.colorbar"><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span></a><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">"seismic"</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><a class="sphinx-codeautolink-a" href="https://numpy.org/doc/stable/reference/generated/numpy.max.html#numpy.max" title="numpy.max"><span class="n">np</span><span class="o">.</span><span class="n">max</span></a><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">vmax</span><span class="o">=</span><a class="sphinx-codeautolink-a" href="https://numpy.org/doc/stable/reference/generated/numpy.max.html#numpy.max" title="numpy.max"><span class="n">np</span><span class="o">.</span><span class="n">max</span></a><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$\mathbf</span><span class="si">{H}</span><span class="s2">_</span><span class="si">{yy}</span><span class="s2">\mathbf</span><span class="si">{f}</span><span class="s2">$"</span><span class="p">)</span>
<a class="sphinx-codeautolink-a" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.colorbar.html#matplotlib.pyplot.colorbar" title="matplotlib.pyplot.colorbar"><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span></a><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$x$"</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$y$"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_DifferentialOperators_34_0.png" src="../_images/examples_DifferentialOperators_34_0.png"/>
</div>
</div>
</section>
</section>
</section>
</article>
<footer class="bd-footer-article">
<div class="footer-article-items footer-article__inner">
<div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
<a class="left-prev" href="Stencils.html" title="previous page">
<i class="fa-solid fa-angle-left"></i>
<div class="prev-next-info">
<p class="prev-next-subtitle">previous</p>
<p class="prev-next-title">Convolution with Pyxu</p>
</div>
</a>
<a class="right-next" href="../api/index.html" title="next page">
<div class="prev-next-info">
<p class="prev-next-subtitle">next</p>
<p class="prev-next-title">API Reference</p>
</div>
<i class="fa-solid fa-angle-right"></i>
</a>
</div></div>
</div>
</footer>
</div>
<div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">
<div class="sidebar-secondary-item">
<div class="page-toc tocsection onthispage">
<i class="fa-solid fa-list"></i> On this page
  </div>
<nav class="bd-toc-nav page-toc">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#1.-Partial-derivatives">1. Partial derivatives</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#1.1.-Parameters">1.1. Parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#1.2.-Finite-differences">1.2. Finite differences</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#1.3.Gaussian-derivative">1.3.Gaussian derivative</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#1.4.-How-to-choose?">1.4. How to choose?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#2.-Stacks-of-partial-derivatives">2. Stacks of partial derivatives</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#2.1.-Parameters">2.1. Parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#2.2.-Gradient">2.2. Gradient</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#2.3.-Hessian">2.3. Hessian</a></li>
</ul>
</li>
</ul>
</nav></div>
<div class="sidebar-secondary-item">
<div id="searchbox"></div></div>
<div class="sidebar-secondary-item">
<div class="tocsection editthispage">
<a href="https://github.com/matthieumeo/pyxu/edit/main/doc/examples/DifferentialOperators.ipynb">
<i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
</div>
</div>
<div class="sidebar-secondary-item">
<div class="tocsection sourcelink">
<a href="../_sources/examples/DifferentialOperators.ipynb">
<i class="fa-solid fa-file-lines"></i> Show Source
    </a>
</div>
</div>
</div></div>
</div>
<footer class="bd-footer-content">
</footer>
</main>
</div>
</div>
<!-- Scripts loaded after <body> so the DOM is not blocked -->
<script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>
<footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
<div class="footer-items__start">
<div class="footer-item">
<p class="copyright">
    
      Â© Copyright 2023, M. Simeoni, S. Kashani, J. RuÃ©-Queralt &amp; Pyxu Developers.
      <br/>
</p>
</div>
<div class="footer-item">
<p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    <br/>
</p>
</div>
<div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
</div>
<div class="footer-items__end">
<div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
</div>
</div>
</footer>
</body>
</html>